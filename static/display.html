<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>APEC Room Display</title>
<style>
body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#0f172a;color:#e5e7eb}
main{max-width:1024px;margin:0 auto;padding:16px}
h1{margin:12px 0}
table{border-collapse:collapse;width:100%}
th,td{border:1px solid #334155;padding:12px;text-align:center;font-size:18px}
th{background:#111827}
.now{background:#22c55e22}
.muted{color:#9ca3af}
</style>
</head>
<body>
<main>
<h1 id="title">Room</h1>
<div class="muted">Auto-updating every 60 seconds</div>
<div style="margin:8px 0">Date: <input type="date" id="date"></div>
<div id="grid"></div>
</main>
<script>
const params=new URLSearchParams(location.search);
const room=params.get('room')||'DM1';
const label={
  'DM1':'DM1 · Meeting Room 1','DM2':'DM2 · Meeting Room 2','DM3':'DM3 · Meeting Room 3','DM4':'DM4 · Outdoor F&B Zone, Office Bus',
  'PM1':'PM1 · Meeting Room 1','PM2':'PM2 · Meeting Room 2','PM3':'PM3 · Meeting Room 3','PM4':'PM4 · Outdoor F&B Zone, Office Bus',
  'GM1':'GM1 · Meeting Room 1','GM2':'GM2 · Meeting Room 2','GM3':'GM3 · Meeting Room 3','GM4':'GM4 · Outdoor F&B Zone, Office Bus',
  'NM1':'NM1 · Outdoor F&B Zone, Office Bus','NM2':'NM2 · Outdoor F&B Zone, Office Bus','NM3':'NM3 · Outdoor F&B Zone, Office Bus','NM4':'NM4 · Outdoor F&B Zone, Office Bus'
};
const HOURS=Array.from({length:17},(_,i)=>i+6);
function fmt(h){return String(h).padStart(2,'0')+':00'}
async function load(date){ const r=await fetch(`/api/availability?date=${date}`); return await r.json(); }
function render(room, rows, date){ const busy=rows.filter(b=>b.room_code===room); let html='<table><thead><tr><th>Time</th><th>Status</th><th>Company</th></tr></thead><tbody>'; for(const h of HOURS){ const b=busy.find(x=>x.start_hour<=h && h<x.end_hour); html+=`<tr class="${b?'now':''}"><td>${fmt(h)}</td><td>${b?'Booked':'Available'}</td><td>${b?b.company:''}</td></tr>`;} html+='</tbody></table>'; document.getElementById('grid').innerHTML=html; document.getElementById('title').textContent=`${label[room]} – ${date}`; }
async function refresh(){ const d=document.getElementById('date').value; const rows=await load(d); render(room, rows, d); }
const today=new Date().toISOString().slice(0,10); document.getElementById('date').value=today; await refresh(); setInterval(refresh, 60000);
</script>
</body>
</html>
