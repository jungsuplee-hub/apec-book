<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>APEC Meeting Rooms - Admin</title>
  <link rel="stylesheet" href="/static/style.css" />
  <link rel="icon" type="image/x-icon" href="https://www.apecceosummitkorea2025.com/images/favicon.ico" />
  <style>
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:10px}
    .toolbar .field{display:flex;flex-direction:column}
    .table-scroll{overflow:auto;max-height:70vh;border:1px solid var(--line);border-radius:12px}
    .danger{background:#c62828;color:#fff;border:none;padding:8px 12px;border-radius:10px;cursor:pointer}
    .danger:hover{filter:brightness(0.95)}
    .danger.small{padding:6px 10px;font-size:var(--fs-sm)}
    .muted{color:var(--muted)}
    .pill{background:#2b2b2b;border:1px solid var(--line);padding:2px 8px;border-radius:999px}
    .alert{padding:10px 12px;border-radius:12px;margin-bottom:12px;font-size:var(--fs-sm)}
    .alert.success{background:#123424;color:#7af9c3;border:1px solid rgba(18,209,142,0.35)}
    .alert.error{background:#341212;color:#ffb4b4;border:1px solid rgba(255,93,93,0.35)}
    .company-tier{margin-top:18px}
    .company-tier h3{margin:0 0 8px;font-size:var(--fs-md);text-transform:uppercase;letter-spacing:0.12em;color:#9ab0d0}
    .company-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px}
    .company-item{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;border:1px solid var(--line);border-radius:12px;background:#101b2d}
    .company-name{font-weight:600}
    .company-actions{display:flex;gap:8px}
  </style>
</head>
<body>
<header class="topbar">
  <div class="topbar-inner">
    <div class="brand">
      <img src="/static/logo-apec.svg" alt="APEC" />
      <span class="brand-caption">MEETING ROOM RESERVATION</span>
    </div>
    <nav class="nav">
      <a href="/launcher" class="button">Display</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <section class="card">
    <h2 class="title">Manage Bookings</h2>

    <form class="toolbar" method="get" action="/admin">
      <label class="field">
        <span>Date</span>
        <select name="date" id="date">
          {% for d in event_dates %}
            <option value="{{ d }}" {% if d == date %}selected{% endif %}>{{ d }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="field">
        <span>Room (optional)</span>
        <select name="room" id="room">
          <option value="" {% if not room %}selected{% endif %}>All</option>
          {% for code,label in room_label.items() %}
            <option value="{{ code }}" {% if room == code %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </label>
      <button class="button" type="submit" style="align-self:flex-end">Filter</button>
      {% if room %}
        <span class="pill">Filtered: {{ room_label[room] }}</span>
      {% endif %}
    </form>

    <div class="table-scroll">
      <table class="table">
        <thead>
          <tr>
            <th style="width:80px">ID</th>
            <th style="width:120px">Date</th>
            <th style="width:140px">Room</th>
            <th style="width:140px">Tier</th>
            <th>Company</th>
            <th style="width:140px">Email</th>
            <th style="width:140px">Time</th>
            <th style="width:120px">Blocks</th>
            <th style="width:110px">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for it in items %}
          <tr>
            <td>{{ it.id }}</td>
            <td>{{ it.date }}</td>
            <td>{{ room_label[it.room_code] if it.room_code in room_label else it.room_code }}</td>
            <td>{{ it.tier }}</td>
            <td>{{ it.company }}</td>
            <td class="muted">{{ it.email }}</td>
            <td>{{ "%02d:00" % it.start_hour }} – {{ "%02d:00" % it.end_hour }}</td>
            <td>{{ it.blocks }}</td>
            <td>
              <form method="post" action="/admin/delete" onsubmit="return confirm('Delete booking #{{ it.id }}?');">
                <input type="hidden" name="booking_id" value="{{ it.id }}">
                <!-- 현재 필터 유지용 -->
                <input type="hidden" name="date" value="{{ date }}">
                {% if room %}<input type="hidden" name="room" value="{{ room }}">{% endif %}
                <button type="submit" class="danger">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
          {% if not items %}
          <tr><td colspan="9" class="muted" style="text-align:center">No bookings.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </section>

  <section class="card">
    <h2 class="title">Manage Companies</h2>

    {% if company_error %}
      <div class="alert error">{{ company_error }}</div>
    {% elif company_msg %}
      <div class="alert success">{{ company_msg }}</div>
    {% endif %}

    <form class="toolbar" method="post" action="/admin/companies/add">
      <label class="field" style="min-width:160px">
        <span>Tier</span>
        <select name="tier" required>
          {% for tier in company_tiers %}
            <option value="{{ tier }}">{{ tier }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="field" style="flex:1">
        <span>Company name</span>
        <input type="text" name="name" placeholder="Enter company name" required />
      </label>
      <button type="submit" class="button" style="align-self:flex-end">Add Company</button>
    </form>

    {% for tier, companies in company_groups.items() %}
      <div class="company-tier">
        <h3>{{ tier }}</h3>
        {% if companies %}
        <ul class="company-list">
          {% for company in companies %}
          <li class="company-item">
            <span class="company-name">{{ company.name }}</span>
            <div class="company-actions">
              <form method="post" action="/admin/companies/delete" onsubmit="return confirm('Delete {{ company.name }}?');">
                <input type="hidden" name="company_id" value="{{ company.id }}" />
                <button type="submit" class="danger small">Delete</button>
              </form>
            </div>
          </li>
          {% endfor %}
        </ul>
        {% else %}
          <p class="muted">No companies registered.</p>
        {% endif %}
      </div>
    {% endfor %}
  </section>
</main>
</body>
</html>

